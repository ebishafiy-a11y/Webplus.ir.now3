<!doctype html>
<html lang="fa" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª - ÙØ±ÙˆØ´Ú¯Ø§Ù‡</title>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Vazir', 'IRANSans', Tahoma, Arial, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            min-height: 100%;
            overflow-x: hidden;
        }

        * {
            box-sizing: border-box;
        }

        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
        }

        .admin-header {
            background: linear-gradient(135deg, #dc143c 0%, #b91c3c 100%);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(220, 20, 60, 0.3);
        }

        .admin-title {
            font-size: 36px;
            font-weight: bold;
            margin: 0 0 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .admin-subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin: 0;
        }

        .auth-section {
            background: #2a2a2a;
            padding: 40px;
            border-radius: 15px;
            max-width: 500px;
            margin: 50px auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .auth-title {
            font-size: 28px;
            font-weight: bold;
            margin: 0 0 30px 0;
            text-align: center;
            color: #dc143c;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #ffffff;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #444;
            border-radius: 8px;
            background: #1a1a1a;
            color: #ffffff;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #dc143c;
            box-shadow: 0 0 10px rgba(220, 20, 60, 0.3);
        }

        .btn-primary {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            background: #dc143c;
            color: #ffffff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #b91c3c;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 20, 60, 0.4);
        }

        .btn-primary:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            background: #ff4444;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }

        .success-message {
            background: #00c851;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }

        .editor-mode-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #dc143c;
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 5px 15px rgba(220, 20, 60, 0.4);
            z-index: 9999;
            display: none;
        }

        .preview-frame-container {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: none;
        }

        .preview-frame {
            width: 100%;
            height: 80vh;
            border: 3px solid #444;
            border-radius: 10px;
            background: white;
        }

        .floating-editor {
            position: fixed;
            bottom: 20px;
            right: -380px;
            width: 350px;
            background: #2a2a2a;
            border-radius: 15px 0 0 15px;
            box-shadow: -5px 0 40px rgba(0,0,0,0.9);
            z-index: 10000;
            transition: right 0.3s ease;
            padding: 20px;
            max-height: 550px;
            overflow-y: auto;
        }

        .floating-editor.active {
            right: 0;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #444;
        }

        .editor-title {
            font-size: 20px;
            font-weight: bold;
            color: #dc143c;
            margin: 0;
        }

        .editor-close {
            background: #dc143c;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .editor-close:hover {
            background: #b91c3c;
            transform: rotate(90deg);
        }

        .editor-field {
            margin-bottom: 20px;
        }

        .editor-label {
            display: block;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #ffffff;
        }

        .editor-input, .editor-textarea {
            width: 100%;
            padding: 12px;
            font-size: 15px;
            border: 2px solid #444;
            border-radius: 8px;
            background: #1a1a1a;
            color: #ffffff;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .editor-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .editor-input:focus, .editor-textarea:focus {
            outline: none;
            border-color: #dc143c;
            box-shadow: 0 0 10px rgba(220, 20, 60, 0.3);
        }

        .editor-image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }

        .editor-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-save {
            flex: 1;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            background: #00c851;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .btn-save:hover {
            background: #00a040;
            transform: translateY(-2px);
        }

        .btn-cancel {
            flex: 1;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            background: #666;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .btn-cancel:hover {
            background: #555;
        }

        .editable-element {
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .editable-element:hover {
            outline: 3px dashed #dc143c;
            outline-offset: 5px;
        }

        .edit-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #dc143c;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 3px 10px rgba(220, 20, 60, 0.5);
        }

        .editable-element:hover .edit-badge {
            display: flex;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 99999;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #444;
            border-top-color: #dc143c;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .logout-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #666;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s ease;
            z-index: 9998;
            display: none;
        }

        .logout-btn:hover {
            background: #555;
        }

        @media (max-width: 768px) {
            .floating-editor {
                width: 90%;
                right: -100%;
                bottom: 10px;
                border-radius: 15px;
                max-height: 450px;
            }
            
            .floating-editor.active {
                right: 5%;
            }

            .admin-title {
                font-size: 28px;
            }

            .auth-section {
                padding: 30px 20px;
            }

            .editor-mode-indicator {
                font-size: 12px;
                padding: 8px 15px;
                top: 10px;
                right: 10px;
            }

            .logout-btn {
                top: 10px;
                left: 10px;
                padding: 8px 15px;
                font-size: 12px;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="loading-overlay" id="loadingOverlay">
   <div class="loading-spinner"></div>
  </div>
  <div class="editor-mode-indicator" id="editorModeIndicator">
   ğŸ“ Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´ ÙØ¹Ø§Ù„ Ø§Ø³Øª
  </div><button class="logout-btn" id="logoutBtn">Ø®Ø±ÙˆØ¬</button>
  <div class="admin-container"><!-- Auth Section -->
   <div class="auth-section" id="authSection">
    <h2 class="auth-title">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h2>
    <div class="error-message" id="errorMessage"></div>
    <div class="success-message" id="successMessage"></div>
    <form id="authForm" onsubmit="handleAuth(event)">
     <div class="form-group"><label class="form-label" for="githubToken">ØªÙˆÚ©Ù† GitHub:</label> <input type="password" id="githubToken" class="form-input" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" required>
     </div><button type="submit" class="btn-primary" id="loginBtn">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù¾Ù†Ù„</button>
    </form>
   </div><!-- Preview Section -->
   <div class="preview-frame-container" id="previewContainer">
    <div class="admin-header">
     <h1 class="admin-title">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±ÙˆØ´Ú¯Ø§Ù‡</h1>
     <p class="admin-subtitle">Ø±ÙˆÛŒ Ù‡Ø± Ù…ØªÙ† ÛŒØ§ ØªØµÙˆÛŒØ± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ ÙˆÛŒØ±Ø§ÛŒØ´ Ø´ÙˆØ¯</p>
    </div><iframe id="previewFrame" class="preview-frame"></iframe>
   </div>
  </div><!-- Floating Editor -->
  <div class="floating-editor" id="floatingEditor">
   <div class="editor-header">
    <h3 class="editor-title" id="editorTitle">ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø­ØªÙˆØ§</h3><button class="editor-close" onclick="closeEditor()">Ã—</button>
   </div>
   <div class="editor-field" id="textField" style="display: none;"><label class="editor-label" for="textInput">Ù…ØªÙ†:</label> <textarea id="textInput" class="editor-textarea" rows="4"></textarea>
   </div>
   <div class="editor-field" id="imageField" style="display: none;"><label class="editor-label" for="imageInput">Ù„ÛŒÙ†Ú© ØªØµÙˆÛŒØ±:</label> <input type="text" id="imageInput" class="editor-input" placeholder="https://example.com/image.jpg"> <label class="editor-label" for="imageFile" style="margin-top: 15px;">ÛŒØ§ Ø¢Ù¾Ù„ÙˆØ¯ Ø§Ø² Ú¯ÙˆØ´ÛŒ:</label> <input type="file" id="imageFile" class="editor-input" accept="image/*" onchange="handleImageUpload(event)"> <img id="imagePreview" class="editor-image-preview" alt="Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´">
   </div>
   <div class="editor-actions"><button class="btn-save" onclick="saveChanges()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª</button> <button class="btn-cancel" onclick="closeEditor()">âŒ Ù„ØºÙˆ</button>
   </div>
  </div>
  <script>
        const GITHUB_USERNAME = 'ebishafiy-a11y';
        const GITHUB_REPO = 'Webplus.ir.now3';
        let githubToken = '';
        let currentEditElement = null;
        let currentEditType = '';
        let indexHtmlContent = '';

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            setTimeout(() => {
                errorEl.style.display = 'none';
            }, 5000);
        }

        function showSuccess(message) {
            const successEl = document.getElementById('successMessage');
            successEl.textContent = message;
            successEl.style.display = 'block';
            setTimeout(() => {
                successEl.style.display = 'none';
            }, 3000);
        }

        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        async function handleAuth(event) {
            event.preventDefault();
            
            const token = document.getElementById('githubToken').value.trim();
            
            if (!token) {
                showError('Ù„Ø·ÙØ§Ù‹ ØªÙˆÚ©Ù† GitHub Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }

            showLoading();
            
            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/index.html`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (!response.ok) {
                    throw new Error('ØªÙˆÚ©Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª ÛŒØ§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…Ø®Ø²Ù† Ù†Ø¯Ø§Ø±ÛŒØ¯');
                }

                const data = await response.json();
                indexHtmlContent = atob(data.content);
                githubToken = token;
                
                sessionStorage.setItem('githubToken', token);
                
                showSuccess('âœ… ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚! Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´...');
                
                setTimeout(() => {
                    loadAdminPanel();
                }, 1000);

            } catch (error) {
                hideLoading();
                showError('âŒ ' + error.message);
            }
        }

        function loadAdminPanel() {
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('previewContainer').style.display = 'block';
            document.getElementById('editorModeIndicator').style.display = 'block';
            document.getElementById('logoutBtn').style.display = 'block';
            
            const iframe = document.getElementById('previewFrame');
            iframe.srcdoc = indexHtmlContent;
            
            iframe.onload = () => {
                makeElementsEditable();
                hideLoading();
            };
        }

        function makeElementsEditable() {
            const iframe = document.getElementById('previewFrame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            const textElements = iframeDoc.querySelectorAll('h1, h2, h3, p, .brand-name, .brand-description, .slider-title, .info-title, .info-text, .cart-title, .cart-text');
            textElements.forEach(el => {
                el.classList.add('editable-element');
                const badge = document.createElement('span');
                badge.className = 'edit-badge';
                badge.textContent = 'âœï¸';
                el.style.position = 'relative';
                el.appendChild(badge);
                
                el.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openTextEditor(el);
                });
            });
            
            const imageElements = iframeDoc.querySelectorAll('.slide-item, .product-item, img');
            imageElements.forEach(el => {
                el.classList.add('editable-element');
                const badge = document.createElement('span');
                badge.className = 'edit-badge';
                badge.textContent = 'ğŸ–¼ï¸';
                el.style.position = 'relative';
                el.appendChild(badge);
                
                el.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openImageEditor(el);
                });
            });
        }

        function openTextEditor(element) {
            currentEditElement = element;
            currentEditType = 'text';
            
            document.getElementById('editorTitle').textContent = 'ÙˆÛŒØ±Ø§ÛŒØ´ Ù…ØªÙ†';
            document.getElementById('textField').style.display = 'block';
            document.getElementById('imageField').style.display = 'none';
            document.getElementById('textInput').value = element.textContent.replace('âœï¸', '').trim();
            
            document.getElementById('floatingEditor').classList.add('active');
        }

        function openImageEditor(element) {
            currentEditElement = element;
            currentEditType = 'image';
            
            document.getElementById('editorTitle').textContent = 'ÙˆÛŒØ±Ø§ÛŒØ´ ØªØµÙˆÛŒØ±';
            document.getElementById('textField').style.display = 'none';
            document.getElementById('imageField').style.display = 'block';
            
            const currentBg = element.style.backgroundImage;
            if (currentBg) {
                const url = currentBg.slice(5, -2);
                document.getElementById('imageInput').value = url;
                document.getElementById('imagePreview').src = url;
                document.getElementById('imagePreview').style.display = 'block';
            }
            
            document.getElementById('floatingEditor').classList.add('active');
        }

        function closeEditor() {
            document.getElementById('floatingEditor').classList.remove('active');
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('imageFile').value = '';
            currentEditElement = null;
            currentEditType = '';
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showError('Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· ÙØ§ÛŒÙ„ ØªØµÙˆÛŒØ± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const dataUrl = e.target.result;
                document.getElementById('imageInput').value = dataUrl;
                document.getElementById('imagePreview').src = dataUrl;
                document.getElementById('imagePreview').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        async function saveChanges() {
            if (!currentEditElement) return;
            
            showLoading();
            
            try {
                let newContent = indexHtmlContent;
                
                if (currentEditType === 'text') {
                    const newText = document.getElementById('textInput').value;
                    const oldText = currentEditElement.textContent.replace('âœï¸', '').trim();
                    newContent = newContent.replace(oldText, newText);
                    currentEditElement.childNodes[0].textContent = newText;
                }
                
                if (currentEditType === 'image') {
                    const newImageUrl = document.getElementById('imageInput').value;
                    if (newImageUrl) {
                        const oldBg = currentEditElement.style.backgroundImage;
                        if (oldBg) {
                            const oldUrl = oldBg.slice(5, -2);
                            newContent = newContent.replace(oldUrl, newImageUrl);
                        }
                        currentEditElement.style.backgroundImage = `url('${newImageUrl}')`;
                    }
                }
                
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/dispatches`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        event_type: 'update-content',
                        client_payload: {
                            content: newContent
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª');
                }
                
                indexHtmlContent = newContent;
                
                hideLoading();
                showSuccess('âœ… ØªØºÛŒÛŒØ±Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!');
                closeEditor();
                
            } catch (error) {
                hideLoading();
                showError('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒï¿½ï¿½Ù‡: ' + error.message);
            }
        }

        document.getElementById('logoutBtn').addEventListener('click', () => {
            sessionStorage.removeItem('githubToken');
            location.reload();
        });

        window.addEventListener('load', () => {
            const savedToken = sessionStorage.getItem('githubToken');
            if (savedToken) {
                document.getElementById('githubToken').value = savedToken;
                handleAuth(new Event('submit'));
            }
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a7ac5cc66512e06',t:'MTc2NDY3Nzk2Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
